<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Excel Data Analyzer</title>
    <link rel="stylesheet" href="style.css">
    <!-- External Libraries - Load before our script -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <h1>üìä Excel Data Analyzer</h1>
            <p class="header-subtitle">Upload your Excel file for comprehensive data analysis and insights</p>
        </header>

        <!-- Privacy Notice -->
        <div class="privacy-notice">
            <p><strong>üîí Privacy:</strong> All file processing happens locally in your browser. No data is sent to any server.</p>
        </div>

        <!-- Error Message -->
        <div class="error-message hidden" id="errorMessage">
            <p id="errorText"></p>
            <button type="button" onclick="document.getElementById('errorMessage').classList.add('hidden')" aria-label="Close error message">√ó</button>
        </div>

        <!-- File Upload Section -->
        <section class="upload-section">
            <div class="upload-area" id="uploadArea" role="button" tabindex="0" aria-label="Click to upload Excel file or drag and drop">
                <div class="upload-content">
                    <div class="upload-icon">üìÑ</div>
                    <h3>Drop your Excel file here</h3>
                    <p><strong>or click to browse for a file</strong></p>
                    <div class="file-formats">
                        <span class="format-tag">.xlsx</span>
                        <span class="format-tag">.xls</span>
                        <span class="size-limit">Max 10MB</span>
                    </div>
                </div>
            </div>
            
            <!-- File input - must be accessible -->
            <input 
                type="file" 
                id="fileInput" 
                accept=".xlsx,.xls,application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet" 
                style="position: absolute; left: -9999px; opacity: 0;" 
                aria-hidden="true"
            >
            
            <!-- Progress Container -->
            <div class="progress-container hidden" id="progressContainer">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <p id="progressText">Processing file...</p>
            </div>
        </section>

        <!-- File Info Section -->
        <section class="file-info-section hidden" id="fileInfoSection">
            <div class="section-header">
                <h2>üìã File Information</h2>
                <div class="action-buttons">
                    <button type="button" id="downloadCsvBtn" class="btn-secondary">Download CSV</button>
                    <button type="button" id="newAnalysisBtn" class="btn-primary">New Analysis</button>
                </div>
            </div>
            <div class="file-info-grid">
                <div class="info-card">
                    <h3>File Details</h3>
                    <p><strong>Name:</strong> <span id="fileName">-</span></p>
                    <p><strong>Size:</strong> <span id="fileSize">-</span></p>
                    <p><strong>Type:</strong> <span id="fileType">-</span></p>
                    <p><strong>Sheets:</strong> <span id="sheetCount">-</span></p>
                </div>
                <div class="info-card">
                    <h3>Data Summary</h3>
                    <p><strong>Rows:</strong> <span id="rowCount">-</span></p>
                    <p><strong>Columns:</strong> <span id="columnCount">-</span></p>
                    <p><strong>Non-empty cells:</strong> <span id="cellCount">-</span></p>
                </div>
            </div>

            <!-- Sheet Selector -->
            <div class="sheet-selector hidden" id="sheetSelector">
                <label for="sheetSelect">Select Sheet:</label>
                <select id="sheetSelect">
                    <option value="">Select a sheet...</option>
                </select>
            </div>
        </section>

        <!-- Data Preview Section -->
        <section class="data-preview-section hidden" id="dataPreviewSection">
            <div class="section-header">
                <h2>üëÄ Data Preview</h2>
                <p>Showing first 50 rows</p>
            </div>
            <div class="table-container">
                <table id="previewTable" class="data-table">
                    <thead></thead>
                    <tbody></tbody>
                </table>
            </div>
        </section>

        <!-- Analysis Section -->
        <section class="analysis-section hidden" id="analysisSection">
            <div class="section-header">
                <h2>üìä Data Analysis</h2>
            </div>

            <!-- Analysis Tabs -->
            <div class="tab-container">
                <button type="button" class="tab-btn active" onclick="showTab('summary')">Summary</button>
                <button type="button" class="tab-btn" onclick="showTab('columns')">Columns</button>
                <button type="button" class="tab-btn" onclick="showTab('charts')">Charts</button>
                <button type="button" class="tab-btn" onclick="showTab('quality')">Data Quality</button>
            </div>

            <!-- Summary Tab -->
            <div id="summaryTab" class="tab-content active">
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>Data Overview</h3>
                        <div id="overviewStats">
                            <p>Upload a file to see analysis...</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <h3>Column Types</h3>
                        <div id="columnTypes">
                            <p>Upload a file to see column breakdown...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Columns Tab -->
            <div id="columnsTab" class="tab-content">
                <div id="columnAnalysis">
                    <p>Upload a file to see detailed column analysis...</p>
                </div>
            </div>

            <!-- Charts Tab -->
            <div id="chartsTab" class="tab-content">
                <div class="charts-grid">
                    <div class="chart-container">
                        <h3>Numerical Data Distribution</h3>
                        <canvas id="histogramChart" width="400" height="300"></canvas>
                    </div>
                    <div class="chart-container">
                        <h3>Categorical Data</h3>
                        <canvas id="categoricalChart" width="400" height="300"></canvas>
                    </div>
                    <div class="chart-container full-width">
                        <h3>Correlation Matrix</h3>
                        <canvas id="correlationChart" width="800" height="400"></canvas>
                    </div>
                </div>
            </div>

            <!-- Data Quality Tab -->
            <div id="qualityTab" class="tab-content">
                <div class="quality-grid">
                    <div class="quality-card">
                        <h3>Data Completeness</h3>
                        <div id="completenessStats">
                            <p>Upload a file to see data quality metrics...</p>
                        </div>
                    </div>
                    <div class="quality-card">
                        <h3>Duplicate Analysis</h3>
                        <div id="duplicateStats">
                            <p>Upload a file to see duplicate analysis...</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer class="footer">
            <p>Built with ‚ù§Ô∏è using SheetJS and Chart.js | All processing happens locally in your browser</p>
        </footer>
    </div>

    <!-- Load our JavaScript last -->
    <script src="app-fixed.js"></script>
</body>
</html>